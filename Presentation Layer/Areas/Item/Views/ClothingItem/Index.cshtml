@model ItemsWithFiltersVM

@if (User.HasClaim("Permission", "ClothingItem.View"))
{
	<div class="p-3">

		<div class="d-flex justify-content-between align-items-center mb-3">
			<h1 class="m-0">Clothing Items</h1>
			@if (User.HasClaim("Permission", "ClothingItem.Add"))
			{
				<div class="col-md-2 d-flex justify-content-end align-items-center">
					<a asp-action="Save" class="btn btn-primary">Add</a>
				</div>
			}
		</div>

		<!-- Search and Filters Section -->
		<div class="card mb-3 compact-filter-card">
			<div class="card-body compact-filter-body">
				<form asp-controller="ClothingItem" asp-action="Index" method="get" class="d-flex align-items-center gap-2">

					<div class="table-search-wrapper" style="width: 250px;">
						<input asp-for="Search" class="form-control form-control-sm" placeholder="Search by Name..." />
						<button type="submit" class="btn btn-sm btn-primary">
							<i class="fa fa-search"></i>
						</button>
					</div>

					<input type="hidden" asp-for="PageId" value="1" />

					<select asp-for="BrandId" asp-items="Model.Brands" class="form-select form-select-sm" style="width: 130px;">
						<option value="">All Brands</option>
					</select>

					<select asp-for="ColorId" asp-items="Model.Colors" class="form-select form-select-sm" style="width: 130px;">
						<option value="">All Colors</option>
					</select>

					<select asp-for="ItemTypeId" asp-items="Model.ItemTypes" class="form-select form-select-sm" style="width: 200px;">
						<option value="">All ItemTypes</option>
					</select>

					<select asp-for="TargetAudienceId" asp-items="Model.TargetAudiences" class="form-select form-select-sm" 
					style="width: 180px; padding-right:12px;">
						<option value="">All TargetAudiences</option>
					</select>

					<button type="submit" class="btn btn-sm btn-primary">Apply</button>
				</form>
			</div>
		</div>

		@if (Model.Items.Count == 0)
		{
			<h3>No Items Found</h3>
		}
		else
		{
			<div class="table-responsive">
				<table id="categoryTable" class="table table-striped  table-bordered">
					<thead class="thead-dark">
						<tr>
							<th width="10%">
								Name
							</th>
							<th width="20%">
								Brand
							</th>
							<th width="10%">
								Color
							</th>
							<th width="20%">
								Clothing Type
							</th>
							<th width="10%">
								Size
							</th>
							<th width="10%">
								For
							</th>
							<th width="10%">
								Actions
							</th>

						</tr>
					</thead>
					<tbody>
						@foreach (var item in Model.Items)
						{
							<tr>
								<td>
									@item.Name
								</td>
								<td>
									@item.Brand.Name
								</td>
								<td>
									@item.Color.Name
								</td>
								<td>
									@item.ItemType.Name
								</td>
								<td>
									@item.Size.Name
								</td>
								<td>
									@item.TargetAudience.Name
								</td>


								<td>
									<div class="d-flex gap-2">


										@if (User.HasClaim("Permission", "ClothingItem.Edit"))
										{
											<a asp-action="Save" asp-route-id="@item.Id" class="btn btn-sm btn-info">
												Edit
											</a>
										}

										@if (User.HasClaim("Permission", "ClothingItem.Delete"))
										{
											<button type="button" class="btn btn-sm btn-danger" data-bs-toggle="modal" data-bs-target="#confirmDeleteModal" data-id="@item.Id" data-name="@item.Name">
												Delete
											</button>
										}
									</div>
								</td>
							</tr>
						}
					</tbody>
				</table>
			</div>
		}
	</div>

	@if (Model.NoPages > 0)
	{
		<div class="d-flex justify-content-center">
			<nav aria-label="Page navigation example">
				<ul class="pagination custom-pagination mb-0">
					@if (Model.PageId > 1)
					{
						<li class="page-item">
							<a class="page-link"
							   asp-action="Index"
							   asp-route-PageId="@(Model.PageId - 1)"
							   asp-route-Search="@Model.Search"
							   asp-route-BrandId="@Model.BrandId"
							   asp-route-ColorId="@Model.ColorId"
							   asp-route-SizeId="@Model.SizeId"
							   asp-route-ItemTypeId="@Model.ItemTypeId"
							   asp-route-TargetAudienceId="@Model.TargetAudienceId">
								Previous
							</a>
						</li>
					}
					@for (int i = 1; i <= Model.NoPages; i++)
					{
						<li class="page-item @(i == Model.PageId ? "active" : "")">
							<a class="page-link"
							   asp-action="Index" asp-route-PageId="@i"
							   asp-route-Search="@Model.Search"
							   asp-route-BrandId="@Model.BrandId"
							   asp-route-ColorId="@Model.ColorId"
							   asp-route-SizeId="@Model.SizeId"
							   asp-route-ItemTypeId="@Model.ItemTypeId"
							   asp-route-TargetAudienceId="@Model.TargetAudienceId">
								@i
							</a>
						</li>
					}
					@if (Model.NoPages > Model.PageId)
					{
						<li class="page-item">
							<a class="page-link"
							   asp-action="Index"
							   asp-route-PageId="@(Model.PageId + 1)"
							   asp-route-Search="@Model.Search"
							   asp-route-BrandId="@Model.BrandId"
							   asp-route-ColorId="@Model.ColorId"
							   asp-route-SizeId="@Model.SizeId"
							   asp-route-ItemTypeId="@Model.ItemTypeId"
							   asp-route-TargetAudienceId="@Model.TargetAudienceId">
								Next
							</a>
						</li>
					}
				</ul>
			</nav>
		</div>
	}

	<partial name="Delete" />

	@section Scripts {
		<script>
			$('#confirmDeleteModal').on('show.bs.modal', function (event) {
				var button = $(event.relatedTarget);

				var Id = button.data('id');
				var Name = button.data('name');

				$(this).find('#Name').text(Name);
				$(this).find('#IdToDelete').val(Id);
			});

			$('#confirmDeleteButton').on('click', function () {
				$('#deleteUser').submit();
			});
		</script>
	}

	@section Styles {
		<link href="~/css/clothingItem.cssrel=" stylesheet" />
		<link href="~/css/pagination.css" rel="stylesheet" />
		<link href="~/css/tableStyling.css" rel="stylesheet" />
	}
}