@model SalesInvoicesVM

<div class="p-3">
	<div class="d-flex justify-content-between align-items-center mb-3">
		<h1 class="m-0">Sales Invoices</h1>
	</div>

	<!-- Search and Filters Section -->
	<div class="card mb-3 compact-filter-card">
		<div class="card-body compact-filter-body">
			<form asp-controller="SalesInvoices" asp-action="Index" method="get" class="row g-2 align-items-center">
				<!-- Search -->
				<div class="col-md-4">
					<div class="table-search-wrapper">
						<input asp-for="Search" class="form-control form-control-sm" placeholder="Search by Code, Customer, or User..." />
						<button type="submit" class="btn btn-sm btn-primary">
							<i class="fa fa-search"></i>
						</button>
					</div>
				</div>
				<input type="hidden" asp-for="PageId" value="1" />
				<input type="hidden" asp-for="SortBy" value="@Model.SortBy" />

				<!-- Branch Filter -->
				<div class="col-md-2">
					<select asp-for="BranchId" asp-items="Model.Branches" class="form-select form-select-sm">
						<option value="">All Branches</option>
					</select>
				</div>

				<!-- Date Filter -->
				<div class="col-md-2">
					<input asp-for="DateFilter" type="date" max="@DateOnly.FromDateTime(DateTime.Now).ToString("yyyy-MM-dd")" class="form-control form-control-sm" />
				</div>

				<!-- Total Qty Filter -->
				<div class="col-md-2">
					<input asp-for="TotalQtyFilter" type="number" min="0" class="form-control form-control-sm" placeholder="Min Qty" />
				</div>

				<!-- Grand Total Filter -->
				<div class="col-md-2">
					<input asp-for="GrandTotalFilter" type="number" min="0" class="form-control form-control-sm" placeholder="Min Total" />
				</div>

				<!-- Apply Button -->
				<div class="col-md-2 d-flex justify-content-end align-items-center">
					<button type="submit" class="btn btn-sm btn-primary">Apply</button>
				</div>
			</form>
		</div>
	</div>

	@if (Model.SalesInvoices.Count == 0)
	{
		<h3>No Invoices Found</h3>
	}
	else
	{
		<!-- Invoices Table -->
		<div class="table-responsive">
			<table id="categoryTable" class="table table-striped table-bordered text-center align-middle">
				<thead class="thead-dark">
					<tr>
						<th width="10%">Invoice Code</th>
						<th width="10%">
							Date
							<a asp-action="Index"
							   asp-route-SortBy="date_asc"
							   asp-route-PageId="1"
							   asp-route-Search="@Model.Search"
							   asp-route-BranchId="@Model.BranchId"
							   asp-route-DateFilter="@Model.DateFilter"
							   asp-route-TotalQtyFilter="@Model.TotalQtyFilter"
							   asp-route-GrandTotalFilter="@Model.GrandTotalFilter"
							   style="color: white;">
								<i class="fas fa-sort-down"></i>
							</a>
							<a asp-action="Index"
							   asp-route-SortBy="date_desc"
							   asp-route-PageId="1"
							   asp-route-Search="@Model.Search"
							   asp-route-BranchId="@Model.BranchId"
							   asp-route-DateFilter="@Model.DateFilter"
							   asp-route-TotalQtyFilter="@Model.TotalQtyFilter"
							   asp-route-GrandTotalFilter="@Model.GrandTotalFilter"
							   style="color: white;">
								<i class="fas fa-sort-up"></i>
							</a>
						</th>
						<th width="5%">
							Total Qty (Items)
							<a asp-action="Index"
							   asp-route-SortBy="qty_asc"
							   asp-route-PageId="1"
							   asp-route-Search="@Model.Search"
							   asp-route-BranchId="@Model.BranchId"
							   asp-route-DateFilter="@Model.DateFilter"
							   asp-route-TotalQtyFilter="@Model.TotalQtyFilter"
							   asp-route-GrandTotalFilter="@Model.GrandTotalFilter"
							   style="color: white;">
								<i class="fas fa-sort-down"></i>
							</a>
							<a asp-action="Index"
							   asp-route-SortBy="qty_desc"
							   asp-route-PageId="1"
							   asp-route-Search="@Model.Search"
							   asp-route-BranchId="@Model.BranchId"
							   asp-route-DateFilter="@Model.DateFilter"
							   asp-route-TotalQtyFilter="@Model.TotalQtyFilter"
							   asp-route-GrandTotalFilter="@Model.GrandTotalFilter"
							   style="color: white;">
								<i class="fas fa-sort-up"></i>
							</a>
						</th>
						<th width="10%">
							Grand Total (EGP)
							<a asp-action="Index"
							   asp-route-SortBy="grand_asc"
							   asp-route-PageId="1"
							   asp-route-Search="@Model.Search"
							   asp-route-BranchId="@Model.BranchId"
							   asp-route-DateFilter="@Model.DateFilter"
							   asp-route-TotalQtyFilter="@Model.TotalQtyFilter"
							   asp-route-GrandTotalFilter="@Model.GrandTotalFilter"
							   style="color: white;">
								<i class="fas fa-sort-down"></i>
							</a>
							<a asp-action="Index"
							   asp-route-SortBy="grand_desc"
							   asp-route-PageId="1"
							   asp-route-Search="@Model.Search"
							   asp-route-BranchId="@Model.BranchId"
							   asp-route-DateFilter="@Model.DateFilter"
							   asp-route-TotalQtyFilter="@Model.TotalQtyFilter"
							   asp-route-GrandTotalFilter="@Model.GrandTotalFilter"
							   style="color: white;">
								<i class="fas fa-sort-up"></i>
							</a>
						</th>
						<th width="20%">Branch</th>
						<th width="20%">Issued By</th>
						<th width="10%">Customer Served</th>
						<th width="15%">Receipt</th>
					</tr>
				</thead>
				<tbody>
					@foreach (var item in Model.SalesInvoices)
					{
						<tr class="align-middle">
							<td>@item.Code</td>
							<td>@item.Date</td>
							<td>@item.TotalQuantity</td>
							<td>@item.RoundedGrandTotal</td>
							<td>@item.Branch.Name</td>
							<td>@item.ApplicationUser.UserName</td>
							<td>@item.RetailCustomer.Name</td>
							<td>
								<a asp-controller="SalesInvoices"
								   asp-action="GetReceipt"
								   asp-route-id="@item.Id"
								   target="_blank"
								   class="btn btn-sm btn-primary d-flex align-items-center justify-content-center">
									Pdf Receipt <i class="fa-solid fa-arrow-up-right-from-square ms-1"></i>
								</a>
							</td>
						</tr>
					}
				</tbody>
			</table>
		</div>
	}

	@if (Model.NoPages > 0)
	{
		<div class="d-flex justify-content-center">
			<nav aria-label="Page navigation example">
				<ul class="pagination custom-pagination mb-0">
					@if (Model.PageId > 1)
					{
						<li class="page-item">
							<a class="page-link" asp-controller="SalesInvoices" asp-action="Index"
							   asp-route-PageId="@(Model.PageId - 1)"
							   asp-route-Search="@Model.Search"
							   asp-route-BranchId="@Model.BranchId"
							   asp-route-DateFilter="@Model.DateFilter"
							   asp-route-TotalQtyFilter="@Model.TotalQtyFilter"
							   asp-route-GrandTotalFilter="@Model.GrandTotalFilter"
							   asp-route-SortBy="@Model.SortBy">
								Previous
							</a>
						</li>
					}
					@for (int i = 1; i <= Model.NoPages; i++)
					{
						<li class="page-item @(i == Model.PageId ? "active" : "")">
							<a class="page-link"
							   asp-controller="SalesInvoices"
							   asp-action="Index"
							   asp-route-PageId="@i"
							   asp-route-Search="@Model.Search"
							   asp-route-BranchId="@Model.BranchId"
							   asp-route-DateFilter="@Model.DateFilter"
							   asp-route-TotalQtyFilter="@Model.TotalQtyFilter"
							   asp-route-GrandTotalFilter="@Model.GrandTotalFilter"
							   asp-route-SortBy="@Model.SortBy">
								@i
							</a>
						</li>
					}
					@if (Model.NoPages > Model.PageId)
					{
						<li class="page-item">
							<a class="page-link"
							   asp-controller="SalesInvoices"
							   asp-action="Index"
							   asp-route-PageId="@(Model.PageId + 1)"
							   asp-route-Search="@Model.Search"
							   asp-route-BranchId="@Model.BranchId"
							   asp-route-DateFilter="@Model.DateFilter"
							   asp-route-TotalQtyFilter="@Model.TotalQtyFilter"
							   asp-route-GrandTotalFilter="@Model.GrandTotalFilter"
							   asp-route-SortBy="@Model.SortBy">
								Next
							</a>
						</li>
					}
				</ul>
			</nav>
		</div>
	}

</div>

@section Styles {
	<link href="~/css/salesinv.css" rel="stylesheet" />
	<link href="~/css/pagination.css" rel="stylesheet" />
	<link href="~/css/tableStyling.css" rel="stylesheet" />
}