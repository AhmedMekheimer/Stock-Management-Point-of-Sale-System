@model ReceiveOrdersWithFiltersVM
@if (User.HasClaim("Permission", "ReceiveOrder.View"))
{
	<div class="p-3">

		<div class="d-flex justify-content-between">
			<h1>Receive Orders</h1>

			<!-- Search and Filters Section -->
			<div class="card mb-3 compact-filter-card">
				<div class="card-body compact-filter-body">
					<form asp-action="Index" method="get" class="row g-2 align-items-center">
						<!-- Search -->
						<div class="col-md-4">
							<div class="table-search-wrapper">
								<input asp-for="Search" class="form-control form-control-sm" placeholder="Search by Code, Customer, or User..." />
								<button type="submit" class="btn btn-sm btn-primary">
									<i class="fa fa-search"></i>
								</button>
							</div>
						</div>
						<input type="hidden" asp-for="PageId" value="1" />
						<input type="hidden" asp-for="SortBy" value="@Model.SortBy" />

						<!-- Branch Filter -->
						<div class="col-md-2">
							<select asp-for="BranchId" asp-items="Model.Branches" class="form-select form-select-sm">
								<option value="">All Branches</option>
							</select>
						</div>

						<!-- Date Filter -->
						<div class="col-md-2">
							<input asp-for="DateFilter" type="date" max="@DateOnly.FromDateTime(DateTime.Now).ToString("yyyy-MM-dd")" class="form-control form-control-sm" />
						</div>

						<!-- Total Qty Filter -->
						<div class="col-md-2">
							<input asp-for="TotalQtyFilter" type="number" min="0" class="form-control form-control-sm" placeholder="Min Qty" />
						</div>

						<!-- Grand Total Filter -->
						<div class="col-md-2">
							<input asp-for="GrandTotalFilter" type="number" min="0" class="form-control form-control-sm" placeholder="Min Total" />
						</div>

						<!-- Apply Button -->
						<div class="col-md-2 d-flex justify-content-end align-items-center">
							<button type="submit" class="btn btn-sm btn-primary">Apply</button>
						</div>
					</form>
				</div>
			</div>

			@if (User.HasClaim("Permission", "ReceiveOrder.Add"))
			{
				<p>
					<a asp-action="Save" class="btn btn-primary">Add</a>
				</p>
			}
		</div>

		@if (Model.ReceiveOrders.Count == 0)
		{
			<h3>No Orders Found</h3>
		}
		else
		{
			<div class="table-responsive">
				<table id="categoryTable" class="table table-striped  table-bordered">
					<thead class="thead-dark">
						<tr>
							<th width="10%">
								Date
								<a asp-action="Index"
								   asp-route-SortBy="date_asc"
								   asp-route-PageId="1"
								   asp-route-Search="@Model.Search"
								   asp-route-BranchId="@Model.BranchId"
								   asp-route-DateFilter="@Model.DateFilter"
								   asp-route-TotalQtyFilter="@Model.TotalQtyFilter"
								   asp-route-GrandTotalFilter="@Model.GrandTotalFilter"
								   style="color: white;">
									<i class="fas fa-sort-down"></i>
								</a>
								<a asp-action="Index"
								   asp-route-SortBy="date_desc"
								   asp-route-PageId="1"
								   asp-route-Search="@Model.Search"
								   asp-route-BranchId="@Model.BranchId"
								   asp-route-DateFilter="@Model.DateFilter"
								   asp-route-TotalQtyFilter="@Model.TotalQtyFilter"
								   asp-route-GrandTotalFilter="@Model.GrandTotalFilter"
								   style="color: white;">
									<i class="fas fa-sort-up"></i>
								</a>
							</th>

							<th width="10%">
								Supplier Name
							</th>
							<th width="10%">
								Branch
							</th>
							<th width="10%">
								Tax Rate
							</th>
							<th width="10%">
								Discount Rate
							</th>
							<th width="10%">
								Total Amount
							</th>
							<th width="10%">
								Confirm
							</th>
							<th width="20%">Actions</th>

						</tr>
					</thead>
					<tbody>
						@foreach (var item in Model.ReceiveOrders)
						{
							<tr>
								<td>
									@item.Date
								</td>
								<td>
									@item.Supplier.Name
								</td>
								<td>
									@item.Branch.Name
								</td>
								<td>
									@item.TotalTaxesRate
								</td>
								<td>
									@item.TotalDiscountRate
								</td>
								<td>
									@item.GrandTotal
								</td>
								<td>
									@if (item.status == Status.Draft)
									{
										<text>

											Not Confirmed

										</text>
									}
									else
									{
										<text>
											Confirmed
										</text>
									}
								</td>
								<td class="row gap-1">

									@if (User.HasClaim("Permission", "ReceiveOrder.Edit"))
									{
										<a asp-action="Save" asp-route-id="@item.Id" class="col-3 btn btn-sm btn-info">Edit</a>

									}
									@if (User.HasClaim("Permission", "ReceiveOrder.Delete") && item.status == Status.Draft)
									{
										<button type="button" class="col-4 btn btn-sm btn-danger" data-bs-toggle="modal" data-bs-target="#confirmDeleteModal" data-id="@item.Id">Delete </button>
									}
								</td>

							</tr>
						}
					</tbody>
				</table>
			</div>
			<partial name="Delete" />
		}

	</div>


	@section Scripts {
		<script>
			$('#confirmDeleteModal').on('show.bs.modal', function (event) {
				var button = $(event.relatedTarget);
				var Id = button.data('id');
				$(this).find('#IdToDelete').val(Id);
			});

			$('#confirmDeleteButton').on('click', function () {
				$('#deleteUser').submit();
			});
		</script>
	}

}