@model ReceiveOrdersWithFiltersVM
@if (User.HasClaim("Permission", "ReceiveOrder.View"))
{
	<div class="p-3">

		<div class="d-flex justify-content-between">
			<h1>Receive Orders</h1>


			@if (User.HasClaim("Permission", "ReceiveOrder.Add"))
			{
				<p>
					<a asp-action="Save" class="btn btn-primary">Add</a>
				</p>
			}
		</div>

		<!-- Search and Filters Section -->
		<div class="card mb-3 compact-filter-card">
			<div class="card-body compact-filter-body">
				<form asp-action="Index" method="get" class="row g-2 align-items-center">
					<!-- Search -->
					<div class="col-md-4">
						<div class="table-search-wrapper">
							<input asp-for="Search" class="form-control form-control-sm" placeholder="Search by Supplier Name..." />
							<button type="submit" class="btn btn-sm btn-primary">
								<i class="fa fa-search"></i>
							</button>
						</div>
					</div>
					<input type="hidden" asp-for="PageId" value="1" />
					<input type="hidden" asp-for="SortBy" value="@Model.SortBy" />

					<!-- Branch Filter -->
					<div class="col-md-2">
						<select asp-for="BranchId" asp-items="Model.Branches" class="form-select form-select-sm">
							<option value="">All Branches</option>
						</select>
					</div>

					<!-- Date Filter -->
					<div class="col-md-2">
						<input asp-for="DateFilter" type="date" max="@DateOnly.FromDateTime(DateTime.Now).ToString("yyyy-MM-dd")" class="form-control form-control-sm" />
					</div>

					<!-- Tax Filter -->
					<div class="col-md-2">
						<input asp-for="TaxRateFilter" type="number" min="0" class="form-control form-control-sm" placeholder="Min Tax" />
					</div>

					<!-- Discount Filter -->
					<div class="col-md-2">
						<input asp-for="DiscountRateFilter" type="number" min="0" class="form-control form-control-sm" placeholder="Min Discount" />
					</div>

					<!-- Grand Total Filter -->
					<div class="col-md-2">
						<input asp-for="GrandTotalFilter" type="number" min="0" class="form-control form-control-sm" placeholder="Min Total" />
					</div>

					<!-- Apply Button -->
					<div class="col-md-2 d-flex justify-content-end align-items-center">
						<button type="submit" class="btn btn-sm btn-primary">Apply</button>
					</div>
				</form>
			</div>
		</div>

		@if (Model.ReceiveOrders.Count == 0)
		{
			<h3>No Orders Found</h3>
		}
		else
		{
			<div class="table-responsive">
				<table id="categoryTable" class="table table-striped  table-bordered">
					<thead class="thead-dark">
						<tr>
							<th width="10%">
								Date
								<a asp-action="Index"
								   asp-route-SortBy="date_asc"
								   asp-route-PageId="1"
								   asp-route-Search="@Model.Search"
								   asp-route-BranchId="@Model.BranchId"
								   asp-route-DateFilter="@Model.DateFilter"
								   asp-route-TaxRateFilter="@Model.TaxRateFilter"
								   asp-route-DiscountRateFilter="@Model.DiscountRateFilter"
								   asp-route-GrandTotalFilter="@Model.GrandTotalFilter"
								   style="color: white;">
									<i class="fas fa-sort-down"></i>
								</a>
								<a asp-action="Index"
								   asp-route-SortBy="date_desc"
								   asp-route-PageId="1"
								   asp-route-Search="@Model.Search"
								   asp-route-BranchId="@Model.BranchId"
								   asp-route-DateFilter="@Model.DateFilter"
								   asp-route-TaxRateFilter="@Model.TaxRateFilter"
								   asp-route-DiscountRateFilter="@Model.DiscountRateFilter"
								   asp-route-GrandTotalFilter="@Model.GrandTotalFilter"
								   style="color: white;">
									<i class="fas fa-sort-up"></i>
								</a>
							</th>

							<th width="10%">
								Supplier Name
							</th>
							<th width="10%">
								Branch
							</th>
							<th width="10%">
								Tax Rate
								<a asp-action="Index"
								   asp-route-SortBy="tax_asc"
								   asp-route-PageId="1"
								   asp-route-Search="@Model.Search"
								   asp-route-BranchId="@Model.BranchId"
								   asp-route-DateFilter="@Model.DateFilter"
								   asp-route-TaxRateFilter="@Model.TaxRateFilter"
								   asp-route-DiscountRateFilter="@Model.DiscountRateFilter"
								   asp-route-GrandTotalFilter="@Model.GrandTotalFilter"
								   style="color: white;">
									<i class="fas fa-sort-down"></i>
								</a>
								<a asp-action="Index"
								   asp-route-SortBy="tax_desc"
								   asp-route-PageId="1"
								   asp-route-Search="@Model.Search"
								   asp-route-BranchId="@Model.BranchId"
								   asp-route-DateFilter="@Model.DateFilter"
								   asp-route-TaxRateFilter="@Model.TaxRateFilter"
								   asp-route-DiscountRateFilter="@Model.DiscountRateFilter"
								   asp-route-GrandTotalFilter="@Model.GrandTotalFilter"
								   style="color: white;">
									<i class="fas fa-sort-up"></i>
								</a>
							</th>
							<th width="10%">
								Discount Rate
								<a asp-action="Index"
								   asp-route-SortBy="disc_asc"
								   asp-route-PageId="1"
								   asp-route-Search="@Model.Search"
								   asp-route-BranchId="@Model.BranchId"
								   asp-route-DateFilter="@Model.DateFilter"
								   asp-route-TaxRateFilter="@Model.TaxRateFilter"
								   asp-route-DiscountRateFilter="@Model.DiscountRateFilter"
								   asp-route-GrandTotalFilter="@Model.GrandTotalFilter"
								   style="color: white;">
									<i class="fas fa-sort-down"></i>
								</a>
								<a asp-action="Index"
								   asp-route-SortBy="disc_desc"
								   asp-route-PageId="1"
								   asp-route-Search="@Model.Search"
								   asp-route-BranchId="@Model.BranchId"
								   asp-route-DateFilter="@Model.DateFilter"
								   asp-route-TaxRateFilter="@Model.TaxRateFilter"
								   asp-route-DiscountRateFilter="@Model.DiscountRateFilter"
								   asp-route-GrandTotalFilter="@Model.GrandTotalFilter"
								   style="color: white;">
									<i class="fas fa-sort-up"></i>
								</a>
							</th>
							<th width="10%">
								Grand Total
								<a asp-action="Index"
								   asp-route-SortBy="grand_asc"
								   asp-route-PageId="1"
								   asp-route-Search="@Model.Search"
								   asp-route-BranchId="@Model.BranchId"
								   asp-route-DateFilter="@Model.DateFilter"
								   asp-route-TaxRateFilter="@Model.TaxRateFilter"
								   asp-route-DiscountRateFilter="@Model.DiscountRateFilter"
								   asp-route-GrandTotalFilter="@Model.GrandTotalFilter"
								   style="color: white;">
									<i class="fas fa-sort-down"></i>
								</a>
								<a asp-action="Index"
								   asp-route-SortBy="grand_desc"
								   asp-route-PageId="1"
								   asp-route-Search="@Model.Search"
								   asp-route-BranchId="@Model.BranchId"
								   asp-route-DateFilter="@Model.DateFilter"
								   asp-route-TaxRateFilter="@Model.TaxRateFilter"
								   asp-route-DiscountRateFilter="@Model.DiscountRateFilter"
								   asp-route-GrandTotalFilter="@Model.GrandTotalFilter"
								   style="color: white;">
									<i class="fas fa-sort-up"></i>
								</a>
							</th>
							<th width="10%">
								Confirm
							</th>
							<th width="20%">Actions</th>

						</tr>
					</thead>
					<tbody>
						@foreach (var item in Model.ReceiveOrders)
						{
							<tr>
								<td>
									@item.Date
								</td>
								<td>
									@item.Supplier.Name
								</td>
								<td>
									@item.Branch.Name
								</td>
								<td>
									@item.TotalTaxesRate
								</td>
								<td>
									@item.TotalDiscountRate
								</td>
								<td>
									@item.GrandTotal
								</td>
								<td>
									@if (item.status == Status.Draft)
									{
										<text>

											Not Confirmed

										</text>
									}
									else
									{
										<text>
											Confirmed
										</text>
									}
								</td>
								<td class="row gap-1">

									@if (User.HasClaim("Permission", "ReceiveOrder.Edit"))
									{
										<a asp-action="Save" asp-route-id="@item.Id" class="col-3 btn btn-sm btn-info">Edit</a>

									}
									@if (User.HasClaim("Permission", "ReceiveOrder.Delete") && item.status == Status.Draft)
									{
										<button type="button" class="col-4 btn btn-sm btn-danger" data-bs-toggle="modal" data-bs-target="#confirmDeleteModal" data-id="@item.Id">Delete </button>
									}
								</td>

							</tr>
						}
					</tbody>
				</table>
			</div>
			<partial name="Delete" />
		}

		@if (Model.NoPages > 0)
		{
			<div class="d-flex justify-content-center">
				<nav aria-label="Page navigation example">
					<ul class="pagination custom-pagination mb-0">
						@if (Model.PageId > 1)
						{
							<li class="page-item">
								<a class="page-link" asp-action="Index"
								   asp-route-PageId="@(Model.PageId - 1)"
								   asp-route-SortBy="grand_desc"
								   asp-route-Search="@Model.Search"
								   asp-route-BranchId="@Model.BranchId"
								   asp-route-DateFilter="@Model.DateFilter"
								   asp-route-TaxRateFilter="@Model.TaxRateFilter"
								   asp-route-DiscountRateFilter="@Model.DiscountRateFilter"
								   asp-route-GrandTotalFilter="@Model.GrandTotalFilter">
									Previous
								</a>
							</li>
						}
						@for (int i = 1; i <= Model.NoPages; i++)
						{
							<li class="page-item @(i == Model.PageId ? "active" : "")">
								<a class="page-link"
								   asp-action="Index"
								   asp-route-PageId="@i"
								   asp-route-SortBy="grand_desc"
								   asp-route-Search="@Model.Search"
								   asp-route-BranchId="@Model.BranchId"
								   asp-route-DateFilter="@Model.DateFilter"
								   asp-route-TaxRateFilter="@Model.TaxRateFilter"
								   asp-route-DiscountRateFilter="@Model.DiscountRateFilter"
								   asp-route-GrandTotalFilter="@Model.GrandTotalFilter">
									@i
								</a>
							</li>
						}
						@if (Model.NoPages > Model.PageId)
						{
							<li class="page-item">
								<a class="page-link" asp-action="Index"
								   asp-route-PageId="@(Model.PageId + 1)"
								   asp-route-SortBy="grand_desc"
								   asp-route-Search="@Model.Search"
								   asp-route-BranchId="@Model.BranchId"
								   asp-route-DateFilter="@Model.DateFilter"
								   asp-route-TaxRateFilter="@Model.TaxRateFilter"
								   asp-route-DiscountRateFilter="@Model.DiscountRateFilter"
								   asp-route-GrandTotalFilter="@Model.GrandTotalFilter">
									Next
								</a>
							</li>
						}
					</ul>
				</nav>
			</div>
		}


	</div>


	@section Scripts {
		<script>
			$('#confirmDeleteModal').on('show.bs.modal', function (event) {
				var button = $(event.relatedTarget);
				var Id = button.data('id');
				$(this).find('#IdToDelete').val(Id);
			});

			$('#confirmDeleteButton').on('click', function () {
				$('#deleteUser').submit();
			});
		</script>
	}

	@section Styles {
		<link href="~/css/pagination.css" rel="stylesheet" />
		<link href="~/css/tableStyling.css" rel="stylesheet" />
	}

}